name: Documentation

on:
  push:
    branches:
      - master

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Set up Python
        uses: actions/setup-python@v1
        with:
          python-version: 3.9
      - name: Install Image Codecs Dependencies
        run: |
          sudo apt-get install \
          python3-blosc \
          python3-brotli \
          python3-snappy \
          python3-lz4 \
          libz-dev \
          libblosc-dev \
          liblzma-dev \
          liblz4-dev \
          libzstd-dev \
          libpng-dev \
          libwebp-dev \
          libbz2-dev \
          libopenjp2-7-dev \
          libjpeg-dev \
          libjxr-dev \
          liblcms2-dev \
          libcharls-dev \
          libaec-dev \
          libbrotli-dev \
          libsnappy-dev \
          libzopfli-dev \
          libgif-dev \
          libtiff-dev
      - name: Install Python Dependencies
        run: |
          pip install --upgrade pip
          pip install .[all]
      - name: Generate Docs
        run: |
          gitchangelog
          make docs
          touch docs/_build/html/.nojekyll
      - name: Publish Docs
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          BASE_BRANCH: master # The branch the action should deploy from.
          BRANCH: gh-pages # The branch the action should deploy to.
          FOLDER: docs/_build/html/ # The folder the action should deploy.
