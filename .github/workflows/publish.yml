name: Publish

on:
  push:
    branches:
      - stable

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Set up Python
        uses: actions/setup-python@v1
        with:
          python-version: 3.9
      - name: Install Image Codecs Dependencies
        run: |
          sudo apt-get install
          python3-blosc
          python3-brotli
          python3-snappy
          python3-lz4
          libz-dev
          libblosc-dev
          liblzma-dev
          liblz4-dev
          libzstd-dev
          libpng-dev
          libwebp-dev
          libbz2-dev
          libopenjp2-7-dev
          libjpeg-dev
          libjxr-dev
          liblcms2-dev
          libcharls-dev
          libaec-dev
          libbrotli-dev
          libsnappy-dev
          libzopfli-dev
          libgif-dev
          libtiff-dev
      - name: Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install setuptools wheel
      - name: Build Package
        run: |
          python setup.py sdist bdist_wheel
      - name: Publish to PyPI
        uses: pypa/gh-action-pypi-publish@master
        with:
          user: aicspypi
          password: ${{ secrets.PYPI_TOKEN }}
