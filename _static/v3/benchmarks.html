<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Benchmarks &mdash; aicsimageio 3.3.7 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="aicsimageio.writers package" href="aicsimageio.writers.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> aicsimageio
          </a>
              <div class="version">
                3.3.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#stable-release">Stable release</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#from-sources">From sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Package modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aicsimageio.html">aicsimageio package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="aicsimageio.readers.html">aicsimageio.readers package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aicsimageio.vendor.html">aicsimageio.vendor package</a></li>
<li class="toctree-l4"><a class="reference internal" href="aicsimageio.writers.html">aicsimageio.writers package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#module-aicsimageio.aics_image">aicsimageio.aics_image module</a></li>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#module-aicsimageio.buffer_reader">aicsimageio.buffer_reader module</a></li>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#module-aicsimageio.constants">aicsimageio.constants module</a></li>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#module-aicsimageio.dask_utils">aicsimageio.dask_utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#module-aicsimageio.exceptions">aicsimageio.exceptions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#module-aicsimageio.transforms">aicsimageio.transforms module</a></li>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#module-aicsimageio.types">aicsimageio.types module</a></li>
<li class="toctree-l3"><a class="reference internal" href="aicsimageio.html#module-aicsimageio">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Benchmarks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#results">Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configs">Configs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#discussion">Discussion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#historical-benchmarks">Historical Benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-tests">Running the Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#deploying">Deploying</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-3-7-2021-05-31">v3.3.7 (2021-05-31)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#fix">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-3-6-2021-05-24">v3.3.6 (2021-05-24)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-3-5-2021-01-25">v3.3.5 (2021-01-25)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id4">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-3-4-2021-01-13">v3.3.4 (2021-01-13)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-3-3-2020-12-14">v3.3.3 (2020-12-14)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id7">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#other">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-3-2-2020-11-17">v3.3.2 (2020-11-17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-3-1-2020-09-23">v3.3.1 (2020-09-23)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id11">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id13">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-3-0-2020-09-09">v3.3.0 (2020-09-09)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#new">New</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-2-3-2020-06-23">v3.2.3 (2020-06-23)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id16">New</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-2-2-2020-06-11">v3.2.2 (2020-06-11)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id18">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id20">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-2-1-2020-05-26">v3.2.1 (2020-05-26)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id23">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-2-0-2020-05-13">v3.2.0 (2020-05-13)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id25">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id29">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id32">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-1-4-2020-03-21">v3.1.4 (2020-03-21)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id36">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id38">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-1-3-2020-03-11">v3.1.3 (2020-03-11)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id40">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id42">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-1-2-2020-03-06">v3.1.2 (2020-03-06)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id44">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id46">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-1-1-2020-02-21">v3.1.1 (2020-02-21)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id49">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id52">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-1-0-2020-02-03">v3.1.0 (2020-02-03)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id55">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id57">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-0-7-2019-11-05">v3.0.7 (2019-11-05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-0-6-2019-10-31">v3.0.6 (2019-10-31)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id61">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id63">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-0-5-2019-10-30">v3.0.5 (2019-10-30)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-0-4-2019-10-28">v3.0.4 (2019-10-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-0-3-2019-10-25">v3.0.3 (2019-10-25)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id66">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#id67">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-0-2-2019-10-11">v3.0.2 (2019-10-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v3-0-1-2019-10-04">v3.0.1 (2019-10-04)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">aicsimageio</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Benchmarks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/benchmarks.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="aicsimageio.writers.html" class="btn btn-neutral float-left" title="aicsimageio.writers package" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="benchmarks">
<h1>Benchmarks<a class="headerlink" href="#benchmarks" title="Permalink to this headline">¶</a></h1>
<p>The development team behind AICSImageIO care deeply about read time. We personally
understand that it is a pretty common experience of simply trying to load a file into
memory and that read resulting in minutes of waiting if the file is large enough.</p>
<p>These benchmarks are our attempt at ensuring we have comparable or better read times
than the other common microscopy image reading libraries:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/imageio/imageio">imageio</a></p></li>
<li><p><a class="reference external" href="https://github.com/cgohlke/tifffile">tifffile</a></p></li>
<li><p><a class="reference external" href="https://pypi.org/project/czifile/">czifile</a></p></li>
</ul>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<a class="reference external image-reference" href="_static/benchmarks/3.1.4-feature.optimize_readers-primary.png"><img alt="aicsimageio read times" src="_images/3.1.4-feature.optimize_readers-primary.png" /></a>
<p><em>Full image read time (seconds) against number of YX planes in the image.</em>
<em>(Lower is better)</em>
<em>aicsimageio.imread read times in blue and</em>
<em>imageio.imread, czifile.imread, or tifffile.imread read times in orange</em></p>
<div class="section" id="configs">
<h3>Configs<a class="headerlink" href="#configs" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">no-cluster</span></code>: single-threaded, no <code class="docutils literal notranslate"><span class="pre">distributed.Client</span></code> connection available</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">small-local-cluster-replica</span></code>: simulates a <code class="docutils literal notranslate"><span class="pre">distributed.LocalCluster</span></code> on common
workstations at AICS. Four (4) Dask workers, each with two (2) cores available.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">many-small-worker-distributed-cluster</span></code>: simulates the normal cluster setup that is
preferred for large workloads. 128 Dask workers, each with one (1) core available.</p></li>
</ul>
</div>
</div>
<div class="section" id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h2>
<p>In single-threaded full-image read performance aicsimageio is at least comparable to
the underlying core libraries. There is overhead from the metadata and dimension
management, but that overhead is typically negligible compared to the raw data read
times. By parallelizing with an underlying Dask implementation we are able to achieve
gains that clearly increase performance in the distributed case. The more workers you
provide to the cluster, the better it gets. With 128 workers reading ~500 YX plane
files (~400MB) we see read times of about 10 seconds.</p>
<p>To gain concurrent read benefits from <code class="docutils literal notranslate"><span class="pre">aicsimageio</span></code> is as easy as:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>from aicsimageio import imread, dask_utils

with dask_utils.cluster_and_client() as (cluster, client):
   img = imread(&quot;my_file.tiff&quot;)
</pre></div>
</div>
<p><strong>Note:</strong> There are two different ways for <code class="docutils literal notranslate"><span class="pre">aicsimageio</span></code> to load imaging data from a
file, either delayed or immediately in memory. Internally, <code class="docutils literal notranslate"><span class="pre">aicsimageio</span></code> determines how
to load the image data based off of which function you ran and if there is a
<code class="docutils literal notranslate"><span class="pre">distributed.Client</span></code> available in the current Python process. The only situation in
which imaging data will be read in a non-delayed fashion is when using <code class="docutils literal notranslate"><span class="pre">AICSImage.data</span></code>
or <code class="docutils literal notranslate"><span class="pre">Reader.data</span></code> while also not having a <code class="docutils literal notranslate"><span class="pre">distributed.Client</span></code> available in the current
Python process. This means that for all other situations and functions,
(<code class="docutils literal notranslate"><span class="pre">AICSImage.dask_data</span></code>, <code class="docutils literal notranslate"><span class="pre">AICSImage.get_image_data</span></code>, <code class="docutils literal notranslate"><span class="pre">AICSImage.get_image_dask_data</span></code>,
etc.), the imaging data is retrieved in a delayed fashion. We do this to optimize read
performance for the majority of situations we encounter as well as additionally
supporting file reading of any size imaging file. The benefits of this strategy can be
seen by our benchmark results above.</p>
</div>
<div class="section" id="historical-benchmarks">
<h2>Historical Benchmarks<a class="headerlink" href="#historical-benchmarks" title="Permalink to this headline">¶</a></h2>
<p>Benchmarks will be ran and published at least every “minor” release.</p>
<ul class="simple">
<li><p>To view or download the charted benchmark results, please see:
<a class="reference external" href="https://github.com/AllenCellModeling/aicsimagio/docs/_static/benchmarks">benchmarks</a></p></li>
<li><p>To view or download the raw benchmark result data, please see:
<a class="reference external" href="https://open.quiltdata.com/b/aics-modeling-packages-test-resources/packages/aicsimageio/benchmarks/revisions">quilt resources</a></p></li>
</ul>
</div>
<div class="section" id="running-the-tests">
<h2>Running the Tests<a class="headerlink" href="#running-the-tests" title="Permalink to this headline">¶</a></h2>
<p>If you are interested in how we run our benchmarks please see the
<a class="reference external" href="https://github.com/AllenCellModeling/aicsimageio/scripts/benchmark.py">benchmark.py</a>
and <a class="reference external" href="https://github.com/AllenCellModeling/aicsimageio/scripts/chart_benchmarks.py">chart_benchmarks.py</a>
files.</p>
<p>Unfortunately, these scripts utilize a
<a class="reference external" href="https://slurm.schedmd.com/overview.html">SLURM cluster</a> to construct the various Dask
cluster configurations. If you have a different HPC cluster at your organization or
prefer using a cloud deployment and wish to run these tests yourself, please see
<a class="reference external" href="https://jobqueue.dask.org/en/latest/">dask_jobqueue</a> and
<a class="reference external" href="https://cloudprovider.dask.org/en/latest/">dask_cloudprovider</a> and swap out the
<code class="docutils literal notranslate"><span class="pre">SLURMCluster</span></code> object for whichever object works best for you. Regardless of underlying
compute, we feel it safe to say the results should be fairly similar to what is
presented in this document.</p>
<p>Full commands to run benchmarks in a fresh environment:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>conda create --name aicsimageio-benchmark python=3.7 -y
conda activate aicsimageio-benchmark
git clone https://github.com/AllenCellModeling/aicsimageio.git
cd aicsimageio
pip install --no-cache-dir -e .[benchmark]
python scripts/download_test_resources.py --top-hash 5e665ed66c1b373a84002227044c7a12a2ecc506b84a730442a5ed798428e26a
python scripts/benchmark.py
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Allen Institute for Cell Science.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>